import { publicKeyTweakMul, privateKeyModInverse } from "secp256k1";
import bs58 from "bs58";

$(document).ready(function() {
  var params = formatUrlParams();
  var cards=[]
  $(".navbar-brand").text(`${params.id}号的牌桌区块链日志`);
  getData(params.id);
  function getData(id) {
    var htmlArray, shuffer_cards, game_result;
    getRequest(`contractlog/findbycol/threecard025/col2/${id}/0`).then(res => {
      htmlArray = res.map(function(item, index) {
        switch (item.key) {
          case "table_create":
            return `<div style="background-color: rgba(215, 225, 244, 1);border:0" class="alert alert-primary" role="alert">${
              item.col1
            }创建牌桌</div>`;
          case "pay":
            return null;
          case "shuffer_cards":
            shuffer_cards = item.col3;
            var extra = shuffer_cards.map((ele, key) => {
              cards.push(ele)
              return `<span>${key + 1}:    ${ele}</span> </br>`;
            });
            extra.unshift(`<p>玩家轮流洗牌并加密,得到52张加密牌数据(PS:洗牌加密过程均在玩家本地完成,每张牌都需要N把密钥才能解开,各玩家各持一个,因此任何玩家都无法单独解开,包括服务器)</p>`)
            return createHtml(
              ` <div class="alert alert-secondary" style="background-color: rgba(244, 216, 216, 1);cursor: pointer; border:0;position:relative"  role="alert">
                <img style="position:absolute;right:10px;width:30px;height:30px;" src="./assets/other/open.png"> 
                玩家轮流洗牌并加密
              </div>`,
              extra.join(""),
              index
            );
          case "game_result":
            game_result = item.col3;
            return formatGameResult(item.col3);
        }
      });
      $("#accordion").html(htmlArray.join(""));
      Decrypt(shuffer_cards, game_result);
    });
  }
  function createHtml(element, extra, id) {
    return `
      <div >
        <div id="heading${id}">
          <div  data-toggle="collapse" data-target="#collapse${id}" aria-expanded="false" aria-controls="collapse${id}">
          ${element}
          </div>
        </div>
      <div id="collapse${id}" class="collapse" aria-labelledby="heading${id}" data-parent="#accordion">
        <div class="card-body">
        ${extra}        
   </div>
      </div>
    </div>
    `;
  }
  function formatGameResult(gameResult) {
    var result = gameResult;
    var resultHtml = result.map((element, index) => {
      switch (element.type) {
        case "ready":
          const num = JSON.parse(element.args).num;
          return `<div class="alert alert alert-success" style="margin-bottom:0px;border-radius:0" role="alert">${
            element.name
          }底注${num}</div>`;
        case "draw":
          const args = JSON.parse(element.args);
          const sendCard = args.map(item => item + 1);
          const card=sendCard.map(ele=>`<p>第${ele}张牌:${cards[ele-1]}</p>`)
          return createHtml(` <div class="alert alert alert-info" role="alert" style="position:relative;background-color: rgba(243, 231, 215, 1);margin-bottom:0px;border-radius:0;cursor: pointer">
          <img style="position:absolute;right:10px;width:30px;height:30px;" src="./assets/other/open.png"> 
          第${sendCard.join(
            ","
          )}张牌发给了${element.name}
          </div>`,`<p>玩家无法单独解开加密数据,因此看不到底牌</p>${card.join("")}`,index);
        case "watch":
          var extra = JSON.parse(element.args).map((item, key) => {
            var nameKey = item.keys.map(ele => {
              return `${ele.name}:${ele.key} </br>`;
            });
            return `<div> 牌${item.index + 1}的keys:<div> ${nameKey.join(
              ""
            )}</div></div></br> `;
          });
          extra.unshift(`<p>其他玩家把持有的${element.name}的底牌的密钥公开,${element.name}解开加密数据,看到底牌,但是其他玩家和服务器仍看不到,因为${element.name}没有把自己的密钥公开</p>`)
          return createHtml(
            `<div class="alert alert-info" role="alert" style=" background-color: rgba(236, 244, 215, 1);cursor: pointer;margin-bottom:0px;border-radius:0;position:relative">
            <img style="position:absolute;right:10px;width:30px;height:30px;" src="./assets/other/open.png"> 

          ${element.name}查看了自己的底牌
     </div>`,
            extra.join(""),
            index
          );
        case "stake":
          const money = JSON.parse(element.args).num;
          return `<div class="alert alert-dark" role="alert" style="background-color: rgba(215, 233, 244, 1);margin-bottom:0px;border-radius:0;">
                     ${element.name}跟注${money}
                </div>`;
        case "pass":
          return createHtml(`<div class="alert alert-danger" role="alert" style="position:relative;cursor: pointer;background-color: rgba(216, 244, 216, 1)">
          <img style="position:absolute;right:10px;width:30px;height:30px;" src="./assets/other/open.png"> 
          ${element.name}弃牌
     </div>`,`<p>弃牌时公开自己持有的其他玩家的密钥,但自己的密钥依然不公开,其他玩家和服务器均看不到${element.name}的底牌</p>`,index) ;
        case "open":
          const openArgs = JSON.parse(element.args);
          return createHtml(`<div class="alert alert-warning" role="alert" style="background-color: rgba(215, 243, 239, 1);position:relative;">
          <img style="position:absolute;right:10px;width:30px;height:30px;" src="./assets/other/open.png"> 
          ${element.name}与${openArgs.target}比牌,支付${
 openArgs.cost
},${openArgs.winner}赢
     </div>`,`<p>所有玩家公开持有的${element.name}和${openArgs.target}的密钥,底牌公开后,进行牌值比较</p>`,index) ;
        case "result":
          const resulTargs = JSON.parse(element.args);
          const resultCard = [];
          return createHtml(
            `<div class="alert alert-success" role="alert" style="background-color: #D7DCF3;cursor: pointer;position:relative;">
            <img style="position:absolute;right:10px;width:30px;height:30px;" src="./assets/other/open.png"> 
          ${element.name}赢牌,收:${resulTargs.money}
     </div>`,
            `<div id="winCard">${resultCard.join("")}</div>`,
            index
          );
        default:
          return null;
      }
    });
    return resultHtml.join("");
  }
  const BaseCard = [
    [
      3,
      108,
      46,
      218,
      195,
      251,
      32,
      193,
      70,
      76,
      72,
      133,
      58,
      30,
      142,
      63,
      186,
      63,
      180,
      14,
      212,
      141,
      18,
      194,
      149,
      124,
      201,
      62,
      116,
      150,
      146,
      22,
      103
    ],
    [
      2,
      44,
      161,
      95,
      33,
      194,
      252,
      189,
      7,
      170,
      82,
      161,
      173,
      235,
      208,
      233,
      51,
      240,
      37,
      92,
      39,
      69,
      225,
      92,
      164,
      46,
      132,
      19,
      59,
      219,
      115,
      137,
      21
    ],
    [
      3,
      93,
      69,
      228,
      230,
      111,
      19,
      216,
      4,
      137,
      98,
      183,
      200,
      127,
      107,
      238,
      135,
      212,
      251,
      160,
      188,
      56,
      193,
      149,
      202,
      64,
      164,
      247,
      3,
      186,
      102,
      178,
      253
    ],
    [
      3,
      211,
      203,
      239,
      25,
      32,
      39,
      155,
      56,
      24,
      187,
      60,
      154,
      94,
      138,
      227,
      92,
      204,
      252,
      169,
      255,
      244,
      142,
      187,
      140,
      2,
      36,
      74,
      217,
      33,
      70,
      65,
      70
    ],
    [
      3,
      196,
      255,
      204,
      73,
      197,
      193,
      165,
      101,
      30,
      174,
      39,
      173,
      66,
      31,
      80,
      113,
      1,
      226,
      132,
      140,
      195,
      37,
      134,
      116,
      242,
      164,
      197,
      94,
      208,
      82,
      102,
      164
    ],
    [
      3,
      122,
      137,
      252,
      225,
      28,
      217,
      51,
      161,
      162,
      45,
      33,
      163,
      197,
      195,
      174,
      118,
      248,
      141,
      121,
      25,
      201,
      4,
      20,
      42,
      218,
      26,
      147,
      251,
      201,
      52,
      48,
      111
    ],
    [
      3,
      67,
      108,
      151,
      124,
      219,
      196,
      186,
      159,
      74,
      235,
      222,
      250,
      247,
      221,
      21,
      45,
      117,
      37,
      57,
      147,
      147,
      221,
      236,
      78,
      66,
      236,
      14,
      166,
      64,
      195,
      85,
      220
    ],
    [
      2,
      156,
      103,
      1,
      13,
      152,
      54,
      207,
      4,
      14,
      75,
      15,
      125,
      148,
      174,
      32,
      237,
      234,
      243,
      245,
      169,
      66,
      205,
      32,
      145,
      114,
      37,
      75,
      22,
      244,
      156,
      204,
      23
    ],
    [
      3,
      132,
      0,
      58,
      196,
      192,
      121,
      225,
      117,
      109,
      189,
      238,
      219,
      219,
      124,
      115,
      150,
      50,
      133,
      91,
      133,
      163,
      72,
      44,
      43,
      109,
      41,
      195,
      250,
      70,
      209,
      90,
      147
    ],
    [
      3,
      36,
      218,
      12,
      215,
      147,
      223,
      135,
      1,
      210,
      65,
      246,
      249,
      30,
      204,
      107,
      10,
      197,
      80,
      147,
      75,
      95,
      93,
      246,
      243,
      194,
      208,
      74,
      101,
      19,
      169,
      109,
      77
    ],
    [
      3,
      227,
      28,
      241,
      40,
      251,
      105,
      78,
      186,
      241,
      137,
      252,
      52,
      193,
      86,
      71,
      99,
      58,
      21,
      18,
      114,
      250,
      3,
      174,
      252,
      104,
      80,
      206,
      128,
      145,
      234,
      204,
      56
    ],
    [
      3,
      176,
      161,
      239,
      199,
      142,
      93,
      129,
      69,
      252,
      195,
      239,
      247,
      238,
      191,
      11,
      34,
      112,
      105,
      134,
      101,
      253,
      223,
      190,
      93,
      109,
      105,
      178,
      45,
      23,
      203,
      145,
      201
    ],
    [
      3,
      44,
      83,
      49,
      161,
      96,
      0,
      74,
      76,
      107,
      132,
      116,
      190,
      126,
      15,
      220,
      44,
      165,
      140,
      7,
      98,
      218,
      141,
      4,
      20,
      15,
      65,
      249,
      22,
      119,
      153,
      214,
      149
    ],
    [
      2,
      81,
      10,
      86,
      142,
      158,
      16,
      73,
      17,
      32,
      91,
      154,
      231,
      107,
      214,
      167,
      227,
      58,
      120,
      64,
      75,
      100,
      68,
      164,
      209,
      227,
      253,
      54,
      159,
      188,
      120,
      30,
      114
    ],
    [
      3,
      70,
      16,
      140,
      232,
      222,
      146,
      142,
      208,
      242,
      192,
      150,
      2,
      118,
      107,
      237,
      194,
      56,
      156,
      183,
      236,
      86,
      204,
      184,
      51,
      52,
      141,
      96,
      170,
      4,
      86,
      53,
      73
    ],
    [
      2,
      177,
      86,
      81,
      94,
      236,
      96,
      31,
      127,
      174,
      104,
      241,
      99,
      208,
      6,
      52,
      132,
      38,
      36,
      87,
      227,
      206,
      205,
      162,
      223,
      185,
      87,
      41,
      66,
      116,
      52,
      214,
      146
    ],
    [
      3,
      186,
      101,
      146,
      167,
      167,
      75,
      200,
      161,
      215,
      150,
      155,
      215,
      140,
      45,
      146,
      122,
      83,
      11,
      161,
      207,
      68,
      183,
      172,
      21,
      122,
      13,
      109,
      203,
      251,
      109,
      220,
      217
    ],
    [
      2,
      61,
      184,
      123,
      72,
      63,
      18,
      173,
      50,
      108,
      234,
      252,
      178,
      178,
      143,
      74,
      113,
      73,
      206,
      221,
      146,
      252,
      23,
      255,
      157,
      139,
      247,
      117,
      143,
      116,
      141,
      154,
      52
    ],
    [
      3,
      3,
      9,
      12,
      55,
      123,
      159,
      254,
      9,
      77,
      206,
      200,
      70,
      222,
      160,
      164,
      227,
      225,
      199,
      49,
      112,
      160,
      156,
      57,
      185,
      12,
      179,
      226,
      174,
      156,
      26,
      62,
      113
    ],
    [
      3,
      38,
      110,
      85,
      26,
      229,
      190,
      247,
      59,
      4,
      29,
      49,
      187,
      172,
      72,
      178,
      6,
      216,
      54,
      109,
      6,
      64,
      11,
      143,
      74,
      83,
      158,
      78,
      248,
      180,
      155,
      140,
      251
    ],
    [
      3,
      173,
      49,
      130,
      46,
      136,
      208,
      163,
      172,
      224,
      131,
      59,
      50,
      46,
      92,
      130,
      147,
      224,
      54,
      46,
      55,
      117,
      74,
      144,
      152,
      149,
      221,
      210,
      81,
      207,
      122,
      186,
      175
    ],
    [
      2,
      154,
      110,
      56,
      6,
      215,
      194,
      57,
      155,
      221,
      212,
      9,
      243,
      144,
      195,
      77,
      112,
      239,
      84,
      2,
      35,
      24,
      247,
      254,
      206,
      41,
      23,
      101,
      211,
      34,
      49,
      106,
      121
    ],
    [
      2,
      39,
      251,
      50,
      141,
      109,
      62,
      79,
      8,
      161,
      245,
      99,
      34,
      141,
      199,
      82,
      98,
      14,
      99,
      46,
      129,
      188,
      35,
      145,
      216,
      0,
      38,
      146,
      37,
      182,
      16,
      60,
      253
    ],
    [
      3,
      151,
      238,
      72,
      31,
      143,
      228,
      45,
      17,
      203,
      154,
      107,
      42,
      172,
      143,
      249,
      71,
      41,
      175,
      212,
      169,
      157,
      31,
      161,
      134,
      242,
      230,
      174,
      69,
      187,
      169,
      235,
      139
    ],
    [
      3,
      19,
      29,
      205,
      17,
      204,
      83,
      172,
      127,
      250,
      121,
      121,
      34,
      50,
      24,
      99,
      219,
      235,
      121,
      1,
      228,
      75,
      77,
      163,
      20,
      122,
      175,
      67,
      148,
      196,
      216,
      29,
      81
    ],
    [
      2,
      64,
      192,
      29,
      211,
      173,
      155,
      76,
      132,
      223,
      113,
      2,
      140,
      1,
      105,
      250,
      219,
      10,
      247,
      111,
      251,
      17,
      219,
      89,
      66,
      34,
      92,
      60,
      182,
      172,
      94,
      108,
      77
    ],
    [
      2,
      175,
      254,
      5,
      72,
      10,
      207,
      184,
      24,
      167,
      151,
      105,
      186,
      230,
      178,
      234,
      153,
      27,
      243,
      10,
      13,
      226,
      38,
      128,
      77,
      130,
      51,
      152,
      23,
      230,
      138,
      244,
      196
    ],
    [
      2,
      128,
      195,
      115,
      32,
      69,
      69,
      200,
      183,
      219,
      3,
      181,
      220,
      88,
      126,
      15,
      191,
      156,
      159,
      209,
      148,
      49,
      39,
      239,
      91,
      4,
      218,
      214,
      48,
      72,
      12,
      230,
      109
    ],
    [
      3,
      122,
      16,
      69,
      251,
      119,
      24,
      108,
      89,
      216,
      200,
      159,
      210,
      148,
      198,
      50,
      4,
      91,
      217,
      179,
      181,
      212,
      145,
      133,
      50,
      186,
      32,
      92,
      221,
      4,
      49,
      38,
      247
    ],
    [
      3,
      148,
      241,
      137,
      145,
      119,
      221,
      89,
      89,
      112,
      195,
      170,
      116,
      217,
      45,
      174,
      7,
      11,
      105,
      43,
      18,
      219,
      186,
      197,
      230,
      145,
      226,
      120,
      245,
      163,
      99,
      46,
      23
    ],
    [
      3,
      54,
      119,
      250,
      156,
      201,
      102,
      12,
      209,
      133,
      243,
      226,
      107,
      49,
      159,
      14,
      120,
      45,
      67,
      197,
      156,
      124,
      61,
      182,
      34,
      225,
      25,
      198,
      216,
      7,
      177,
      150,
      237
    ],
    [
      2,
      62,
      58,
      52,
      124,
      50,
      13,
      43,
      1,
      84,
      78,
      3,
      144,
      142,
      205,
      93,
      178,
      120,
      35,
      167,
      149,
      152,
      118,
      27,
      239,
      216,
      85,
      55,
      87,
      144,
      144,
      92,
      114
    ],
    [
      3,
      62,
      47,
      202,
      141,
      103,
      57,
      206,
      250,
      42,
      93,
      212,
      243,
      81,
      65,
      144,
      130,
      221,
      56,
      129,
      207,
      99,
      79,
      172,
      246,
      102,
      58,
      234,
      29,
      5,
      165,
      197,
      236
    ],
    [
      3,
      244,
      249,
      100,
      124,
      199,
      15,
      31,
      183,
      145,
      248,
      18,
      250,
      126,
      148,
      16,
      76,
      58,
      210,
      176,
      167,
      43,
      219,
      234,
      101,
      111,
      175,
      128,
      9,
      15,
      136,
      161,
      37
    ],
    [
      2,
      115,
      183,
      136,
      231,
      44,
      80,
      5,
      238,
      37,
      37,
      38,
      202,
      137,
      226,
      17,
      101,
      252,
      141,
      79,
      33,
      221,
      169,
      234,
      152,
      192,
      9,
      221,
      65,
      31,
      65,
      1,
      157
    ],
    [
      3,
      45,
      75,
      246,
      59,
      175,
      3,
      245,
      150,
      153,
      122,
      183,
      57,
      231,
      91,
      130,
      213,
      211,
      148,
      45,
      201,
      24,
      32,
      117,
      111,
      200,
      178,
      14,
      89,
      146,
      13,
      253,
      135
    ],
    [
      3,
      228,
      65,
      115,
      177,
      20,
      233,
      124,
      21,
      191,
      94,
      74,
      47,
      90,
      119,
      74,
      47,
      131,
      205,
      179,
      140,
      35,
      136,
      9,
      200,
      205,
      241,
      187,
      44,
      0,
      137,
      41,
      230
    ],
    [
      2,
      156,
      101,
      153,
      161,
      198,
      67,
      13,
      71,
      252,
      20,
      32,
      104,
      57,
      185,
      202,
      70,
      173,
      176,
      157,
      26,
      90,
      200,
      216,
      179,
      202,
      130,
      117,
      107,
      85,
      240,
      136,
      35
    ],
    [
      2,
      83,
      75,
      121,
      23,
      230,
      227,
      231,
      9,
      209,
      142,
      158,
      9,
      47,
      198,
      208,
      8,
      104,
      168,
      120,
      26,
      121,
      46,
      64,
      167,
      59,
      55,
      144,
      185,
      8,
      35,
      63,
      53
    ],
    [
      3,
      18,
      119,
      254,
      101,
      20,
      166,
      249,
      56,
      81,
      246,
      253,
      91,
      216,
      133,
      229,
      130,
      123,
      190,
      64,
      71,
      158,
      1,
      80,
      69,
      99,
      3,
      66,
      127,
      211,
      71,
      34,
      97
    ],
    [
      3,
      74,
      198,
      212,
      144,
      62,
      71,
      26,
      227,
      99,
      75,
      222,
      208,
      178,
      118,
      71,
      86,
      169,
      58,
      171,
      217,
      139,
      202,
      224,
      109,
      34,
      171,
      52,
      61,
      105,
      5,
      253,
      156
    ],
    [
      3,
      220,
      9,
      144,
      16,
      136,
      183,
      13,
      255,
      5,
      170,
      120,
      117,
      109,
      31,
      84,
      124,
      136,
      103,
      110,
      91,
      153,
      139,
      147,
      106,
      179,
      83,
      79,
      211,
      233,
      230,
      117,
      110
    ],
    [
      2,
      245,
      159,
      135,
      31,
      98,
      59,
      31,
      253,
      146,
      49,
      203,
      56,
      252,
      8,
      119,
      10,
      78,
      99,
      76,
      113,
      90,
      105,
      82,
      213,
      231,
      150,
      179,
      171,
      234,
      245,
      230,
      8
    ],
    [
      2,
      96,
      108,
      14,
      129,
      241,
      28,
      250,
      221,
      157,
      101,
      155,
      147,
      27,
      217,
      58,
      106,
      163,
      247,
      170,
      136,
      194,
      84,
      253,
      239,
      110,
      206,
      79,
      49,
      109,
      145,
      14,
      168
    ],
    [
      3,
      85,
      70,
      246,
      181,
      46,
      50,
      154,
      56,
      245,
      180,
      207,
      84,
      114,
      176,
      189,
      118,
      87,
      76,
      174,
      198,
      215,
      71,
      230,
      62,
      120,
      92,
      177,
      96,
      178,
      89,
      241,
      78
    ],
    [
      2,
      116,
      30,
      183,
      202,
      193,
      166,
      101,
      118,
      47,
      32,
      22,
      167,
      65,
      134,
      225,
      211,
      194,
      208,
      224,
      0,
      249,
      88,
      208,
      194,
      167,
      138,
      190,
      129,
      54,
      114,
      46,
      131
    ],
    [
      2,
      31,
      141,
      139,
      120,
      176,
      4,
      166,
      32,
      207,
      183,
      40,
      3,
      145,
      55,
      132,
      201,
      83,
      3,
      212,
      7,
      165,
      147,
      113,
      168,
      242,
      169,
      85,
      234,
      1,
      39,
      18,
      36
    ],
    [
      2,
      33,
      65,
      22,
      73,
      239,
      181,
      187,
      34,
      128,
      51,
      249,
      11,
      76,
      51,
      15,
      41,
      145,
      128,
      17,
      251,
      87,
      118,
      25,
      219,
      143,
      122,
      48,
      100,
      66,
      77,
      69,
      211
    ],
    [
      3,
      66,
      9,
      228,
      82,
      14,
      19,
      231,
      40,
      65,
      170,
      30,
      191,
      216,
      234,
      64,
      171,
      231,
      58,
      58,
      255,
      197,
      103,
      170,
      37,
      216,
      226,
      40,
      114,
      6,
      15,
      122,
      120
    ],
    [
      3,
      52,
      76,
      143,
      115,
      237,
      139,
      186,
      25,
      48,
      69,
      114,
      32,
      84,
      228,
      4,
      143,
      51,
      58,
      166,
      77,
      22,
      75,
      247,
      113,
      122,
      60,
      82,
      253,
      187,
      234,
      198,
      41
    ],
    [
      3,
      84,
      210,
      177,
      143,
      36,
      171,
      59,
      210,
      139,
      108,
      30,
      207,
      226,
      241,
      95,
      207,
      114,
      111,
      79,
      240,
      116,
      190,
      131,
      237,
      17,
      237,
      237,
      84,
      133,
      200,
      71,
      68
    ],
    [
      2,
      97,
      245,
      187,
      215,
      67,
      235,
      136,
      108,
      71,
      147,
      76,
      226,
      113,
      167,
      46,
      3,
      90,
      161,
      245,
      135,
      191,
      83,
      191,
      210,
      251,
      41,
      207,
      179,
      201,
      153,
      32,
      71
    ]
  ];
  const BaseCardMap = BaseCard.map(card => Buffer.from(card));
  function Decrypt(shuffer_cards, game_result, showNUm) {
    console.log(shuffer_cards);
    console.log(game_result);
    try {
      var jsonShufferCards = shuffer_cards;
      var jsonJGameResult = game_result;
      var ShufferArray = jsonShufferCards.map((item, index) => {
        return Buffer.from(bs58.decode(item));
      });
      var result;
      console.log("jsonJGameResult", jsonJGameResult);
      jsonJGameResult.map((item, index) => {
        if (item.type == "result") {
          result = JSON.parse(item.args).cards;
        }
      });
      console.log(result);
      result.forEach(user_cards_prikeys => {
        var card_ids = [];
        user_cards_prikeys.cards.forEach(card_prikeys => {
          var privateKeys = [];
          card_prikeys.keys.forEach(key_data => {
            privateKeys.push(Buffer.from(bs58.decode(key_data.key)));
          });
          var decrypted = privateKeys.reduce(
            (prevCard, currCard) =>
              publicKeyTweakMul(prevCard, privateKeyModInverse(currCard), true),
            ShufferArray[card_prikeys.index]
          );
          var cardId = BaseCardMap.findIndex(cardKey => {
            return cardKey.equals(decrypted);
          });
          card_ids.push(cardId);
        });
        var whoseCard = user_cards_prikeys.name;
        var cards = showCard(card_ids);
        result.forEach((v, k) => {
          if (v.name == whoseCard) {
            result[k].cards.forEach((value, key) => {
              result[k].cards[key].img = cards[key];
            });
          }
        });
        const resultCard = result.map(payler => {
          const playerCard = payler.cards.map(item => {
            const evevyKey = item.keys.map(ele => {
              return `${ele.key}</br> `;
            });
            return `<div class="showCardKeyContainer"><div>${
              item.img
            }</div> ${evevyKey.join("")}</div>`;
          });
          return `<div><p>${payler.name}</p> </br> ${playerCard.join(
            ""
          )}</div>`;
        });

        $("#winCard").html(resultCard.join(""));
        $(".footer").append(`<div>
            <h5>${whoseCard}的牌</h5>
            ${cards.join("")}
        </div>`);
      });
    } catch (err) {
      console.log(err);
    }
  }
  function showCard(acceptCard) {
    const card = acceptCard.map((item, index) => {
      if (item < 13) {
        return `<img src="./assets/black/card_2_${Number(item)+1}.png" alt=""/> `;
      } else if (item >= 13 && item < 26) {
        return `<img src="./assets/red/card_3_${Number(item)-12}.png" alt=""/> `;
      } else if (item >= 26 && item < 39) {
        console.log(item);
        return `<img src="./assets/blossom/card_4_${Number(item)-25}.png" alt=""/> `;
      } else {
        return `<img src="./assets/block/card_1_${Number(item)-38}.png" alt=""/> `;
      }
    });
    return card;
  }
});
